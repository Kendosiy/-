<!DOCTYPE html>
<html>
	<head>
		<meta charset="utf-8">
		<link href="../../style.css" rel="stylesheet">
	</head>
	<body>
		<header>
			<div>
				<a href="../../index.html"><h1>Учебный портал</h1></a>
			</div>
			<nav>
					<ul class="main_menu">
					<li>
<<<<<<< HEAD
<<<<<<< HEAD
						<a href="#"><p>Справочные материалы</p></a>
=======
						<a href="#"><p>Справочные материалы&#9207;</p></a>
>>>>>>> f12edd62888d7f1067e2a4e99743dfe436d13998
=======
						<a href="#"><p>Справочные материалы&#9207;</p></a>
>>>>>>> f12edd62888d7f1067e2a4e99743dfe436d13998
						<ul class="submenu" id="sub1">
							<li><a href="../../delphi-lab-teor.html">Теория по Delphi</a></li>
						</ul>
					</li>
					<li>
<<<<<<< HEAD
<<<<<<< HEAD
						<a href="#"><p>Лабораторные работы</p></a>
=======
						<a href="#"><p>Лабораторные работы&#9207;</p></a>
>>>>>>> f12edd62888d7f1067e2a4e99743dfe436d13998
=======
						<a href="#"><p>Лабораторные работы&#9207;</p></a>
>>>>>>> f12edd62888d7f1067e2a4e99743dfe436d13998
						<ul class="submenu" id="sub2">
							<li><a href="../../delphi-lab-prac.html">Задания по Delphi</a></li>
						</ul>
					</li>
				</ul>
			</nav>
		</header>
		<main>
			<div class="prev"><a href="tema3.html"><img src="../../res/prev.png"></a></div>
			<div class="next" style="opacity: 0.5;"><img src="../../res/next.png"></div>
			<aside id="sidebar">
				<h2>Быстрая навигация</h2>
				<ol>
					<li><a href="#1">Работа с текстовыми файлами</a></li>
					<li><a href="#2">Работа с типизированными файлами</a></li>
					<li><a href="#3">Работа с нетипизированными файлами</a></li>
					<li><a href="#4">Контроль ошибок при работе с файлами</a></li>
				</ol>
			</aside>
			<article class="tema">
				<h2>
					Типы файлов
				</h2>
				<p>
					Файл – поименованная область внешней памяти. Файл имеет имя, что позволяет
					программе работать с несколькими файлами одновременно. Он состоит из
					компонентов любого типа, кроме файлового. Длина файла заранее неизвестна и
					ограничена только емкостью устройства внешней памяти.
				</p>
				<p>
					Среда Delphi дает 4 варианта работы с файлами:
				</p>
				<p>
					1. использование набора функций ОР и файловых переменных;
				</p>
				<p>
					2. использование функций ввода-вывода API;
				</p>
				<p>
					3. использование потоков;
				</p>
				<p>
					4. использование отображаемых файлов.
				</p>
				<p>
					В данной лекции рассматривается 1 вариант.
				</p>
				<p>
					При организации файлового ввода-вывода необходимо знать, какого рода
					информация содержится в файле. Чаще всего это строки или двоичные данные,
					но могут быть массивы, записи и т.д. Сведения о типе хранящихся в файле
					данных задаются изначально с помощью файловой переменной. Файловая
					переменная служит для связи между файлом и приложением. Тип ее зависит от
					типа файла.
				</p>
				<p>
					В ОР используются файловые переменные 3-х типов:
				</p>
				<p>
					1. текстовые – TextFile – набор символьных строк;
				</p>
				<p>
					2. типизированные – File of &lt;тип&gt; - набор данных указанного типа;
				</p>
				<p>
					3. нетипизированные – File – набор неструктурированных данных.
				</p>
				<p>
					Для доступа к файлам используются стандартные процедуры и функции:
				</p>
				<p>
					1. AssignFile(&lt;имя файловой переменной&gt;,&lt;имя файла&gt;) –
					устанавливает связь файла с файловой переменной;
				</p>
				<p>
					2. Reset(&lt;имя файловой переменной&gt;) – открывает текстовый файл для
					чтения, а файлы других типов – для чтения и записи. Текущая позиция
					устанавливается на начало файла. Если файла с таким именем не существует,
					возникнет исключительная ситуация.
				</p>
				<p>
					3. Rewrite(&lt;имя файловой переменной&gt;) – создает новый файл и
					открывает его. Если файл с таким именем существует, он удаляется и
					заменяется новым. Текстовые файлы этой командой открываются только для
					записи. Файлы остальных типов могут использоваться и для чтения, и для
					записи.
				</p>
				<p>
					4. Append(&lt;имя файловой переменной&gt;) – используется для открытия
					только текстовых файлов с целью дозаписи информации в файл. Если файла с
					таким именем не существует, возникнет исключительная ситуация.
				</p>
				<p>
					5. CloseFile(&lt;имя файловой переменной&gt;) – закрывает открытый файл с
					сохранением всех сделанных в него записей. Связь между файловой переменной
					и файлом при этом не разрывается;
				</p>
				<a name="1"></a>
				<h2>
					Работа с текстовыми файлами
				</h2>
				<p>
					Для организации ввода-вывода информации используются следующие процедуры:
				</p>
				<ol start="1" type="1">
					<li>
						Readln(&lt;имя файловой переменной&gt;, S: string) – считывает строку
						из текстового файла в переменную S и переходит к следующей строке;
					</li>
					<li>
						Writeln (&lt;имя файловой переменной&gt;, S: string) – записывает
						строку в текстовый файл из переменной S и переходит на следующую
						строку;
					</li>
					<li>
						Read(&lt;имя файловой переменной&gt;, S:string&gt;) – считывает из
						файла информацию в переменную S;
					</li>
					<li>
						Write(&lt;имя файловой переменной&gt;, S: string) – записывает в файл
						информацию из переменной S.
					</li>
				</ol>
				<p>
					Пример: записать в файл содержимое таблицы StringGrid.
				</p>
				<p>
					Кроме содержимого ячеек в файле следует сохранить информацию о размерности
					таблицы.
				</p>
				<p>
					<strong>procedure </strong>
					TForm1.Button1Click(Sender: TObject);
				</p>
				<p>
					<strong>var</strong>
				</p>
				<p>
					i,j:integer;
				</p>
				<p>
					ff:TextFile;
				</p>
				<p>
					<strong>begin</strong>
				</p>
				<p>
					AssignFile(ff,'aa.tab');
				</p>
				<p>
					Rewrite(ff);
				</p>
				<p>
					writeln(ff,inttostr(StringGrid1.Colcount));
				</p>
				<p>
					writeln(ff,inttostr(StringGrid1.RowCount));
				</p>
				<p>
					<strong>for</strong>
					i:=0 <strong>to</strong> StringGrid1.ColCount-1 <strong>do</strong>
				</p>
				<p>
					<strong>for</strong>
					j:=0 <strong>to</strong> StringGrid1.RowCount-1 <strong>do</strong>
				</p>
				<p>
					Writeln(ff,StringGrid1.Cells[i,j]);
				</p>
				<p>
					CloseFile(ff);
				</p>
				<p>
					<strong>end;</strong>
				</p>
				<a name="2"></a>
				<h2>
					Работа с типизированными файлами
				</h2>
				<p>
					Для чтения-записи используются операторы:
				</p>
				<ol start="1" type="1">
					<li>
						Read(&lt;имя файловой переменной&gt;, S:&lt;тип&gt;) – считывает из
						файла информацию в переменную S;
					</li>
					<li>
						Write(&lt;имя файловой переменной&gt;, S:&lt;тип&gt;) – записывает в
						файл информацию из переменной S.
					</li>
				</ol>
				<p>
					В таких файлах можно получить прямой доступ к каждому из компонентов.
				</p>
				<p>
					FilePos(&lt;имя файловой переменной&gt;) – возвращает текущую позицию в
					файле, т.е. номер компонента, который будет обрабатываться следующим.
				</p>
				<p>
					FileSize(&lt;имя файловой переменной&gt;) – количество компонентов в файле.
				</p>
				<p>
					Seek(&lt;имя файловой переменной&gt;,&lt;номер компонента файла&gt;) –
					смещает текущую позицию к указанному элементу.
				</p>
				<p>
					Пример:
				</p>
				<p>
					Требуется построить график изменения параметра по числовым данным, которые
					пользователь вводит в Мемо. Исходные данные сохраняются в типизированный
					файл. При открытии файла готовый график выводится на экран.
				</p>
				<p>
					<strong>procedure</strong>
					TForm1.Button1Click(Sender: TObject); {запись файла}
				</p>
				<p>
					<strong>var</strong>
				</p>
				<p>
					ff:file of integer; i,x,y:integer;
				</p>
				<p>
					<strong>begin</strong>
				</p>
				<p>
					assignfile(ff,'a1.ddd');
				</p>
				<p>
					rewrite(ff);
				</p>
				<p>
					i:=0;
				</p>
				<p>
					<strong>while</strong>
					i&lt;Memo1.Lines.Count-1 <strong>do</strong>
				</p>
				<p>
					<strong> begin</strong>
				</p>
				<p>
					x:=strtoint(Memo1.Lines[i]);
				</p>
				<p>
					y:=strtoint(Memo1.Lines[i+1]);
				</p>
				<p>
					write(ff,x,y);
				</p>
				<p>
					i:=i+2;
				</p>
				<p>
					<strong> end;</strong>
				</p>
				<p>
					closeFile(ff);
				</p>
				<p>
					end;
				</p>
				<p>
					<strong></strong>
				</p>
				<p>
					<strong></strong>
				</p>
				<p>
					<strong>procedure</strong>
					TForm1.Button2Click(Sender: TObject); {чтение из файла и построение
					графика}
				</p>
				<p>
					<strong>var</strong>
				</p>
				<p>
					ff:file of integer; x,y:integer;
				</p>
				<p>
					<strong>begin</strong>
				</p>
				<p>
					assignfile(ff,'a1.ddd');
				</p>
				<p>
					reset(ff);
				</p>
				<p>
					Chart1.SeriesList[0].Clear;
				</p>
				<p>
					x:=0; y:=0;
				</p>
				<p>
					<strong>while</strong>
					filepos(ff)&lt;filesize(ff) <strong>do</strong>
				</p>
				<p>
					<strong>begin</strong>
				</p>
				<p>
					read(ff,x,y);
				</p>
				<p>
					Chart1.SeriesList[0].AddXY(x,y,'',clBlue);
				</p>
				<p>
					<strong>end</strong>
					<strong>;</strong>
				</p>
				<p>
					closeFile(ff);
				</p>
				<p>
					<strong>end;</strong>
				</p>
				<a name="3"></a>
				<h2>
					Работа с нетипизированными файлами
				</h2>
				<p>
					Нетипизированные файлы используются для организации высокоскоростного
					обмена данными между диском и памятью. Эти файлы также совместимы с любыми
					другими типами файлов, т.е. через нетипизированную файловую переменную
					можно открыть файл любого типа.
				</p>
				<p>
					При чтении-записи информация из такого файла выдается по частям – записям.
					Размер записи указывается в качестве параметра у процедуры открытия файла:
					например Reset(ff, 512), где длина записи – 512 байт. Если этот параметр не
					указан, то длина записи – 128 байт.
				</p>
				<p>
					Для чтения данных используется процедура BlockRead. В качестве параметров
					передаются имя файловой переменной, имя переменной, в которую сбрасывается
					информация, и количества считываемых серий. Например: BlockRead(ff,S,100).
				</p>
				<p>
					Для записи данных используется процедура BlockWrite. Ее параметры
					аналогичны.
				</p>
				<a name="4"></a>
				<h2>
					Контроль ошибок при работе с файлами
				</h2>
				<p>
					При работе с файлами часто возникают различные ошибки. Существует несколько
					способов обработать эти ошибки.
				</p>
				<p>
					Ошибки при работе с файлами описаны в стандартном классе EinOutError,
					который позволяет даже различать виды ошибок. Для использования его в
					программе необходимо подключить автоконтроль операций ввода-вывода. Это
					делается с помощью директив компилятору {$I+} и {$I-}.
				</p>
				<p>
					Другой вариант использования защищенного блока позволяет обойтись без
					стандартных классов:
				</p>
				<p>
					AssignFile(ff, ‘a1.ddd);
				</p>
				<p>
					<strong>Try</strong>
				</p>
				<p>
					Reset(ff);
				</p>
				<p>
					<strong>Except</strong>
				</p>
				<p>
					ShowMessage(‘Произошла ошибка. Нельзя открыть файл’);
				</p>
				<p>
					Exit;
				</p>
				<p>
					<strong>End;</strong>
				</p>
				<p>
					Существует процедура FileExist, которая проверяет существование файла и
					выдает True, если файл существует. Пример:
				</p>
				<p>
					<strong>If</strong>
					FileExist(OpenDialog1.FileName) <strong>then</strong>
					Memo1.Lines.LoadFromFile(OpenDialog1.FileName) <strong>else</strong> exit;
				</p>
				<p>
					Третий вариант связан с использованием функции IOResult, которая возвращает
					0, если работа с файлом прошла успешно. При использовании этой функции
					автоматический контроль ошибок следует отключить.
				</p>
				<p>
					AssignFile(ff, ‘a1.ddd);
				</p>
				<p>
					{$I-}
				</p>
				<p>
					Reset(ff);
				</p>
				<p>
					{$I+}
				</p>
				<p>
					<strong>if </strong>
				IOResult=0 <strong>then</strong> ShowMessage(‘Файл существует’)	<strong>else</strong> exit;
				</p>
			</article>	
		</main>
		<footer class="footer">
			<div></div>
		</footer>
		<script src="../../scripts.js"></script>
	</body>
</html>